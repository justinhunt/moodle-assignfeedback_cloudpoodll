<script type="module">
    import {setup} from "https://www.unpkg.com/@loomhq/record-sdk@2.36.18/dist/esm/index.js?module";
    import {isSupported} from "https://www.unpkg.com/@loomhq/record-sdk@2.36.18/dist/esm/is-supported.js?module";
    import * as loomembed from "https://www.unpkg.com/@loomhq/loom-embed@1.2.2/dist/esm/index.js?module";


    const PUBLIC_APP_ID = "public-app-id-obtained-from-developer-portal";
    const BUTTON_ID = "loombutton";

    function insertEmbedPlayer(html) {
        const target = document.getElementById("loomtarget");

        if (target) {
            target.innerHTML = html;
        }
    }

    async function init() {
        const { supported, error } = await isSupported();

        if (!supported) {
            console.warn(`Error setting up Loom: ${error}`);
            return;
        }


        const button = document.getElementById(BUTTON_ID);

        if (!button) {
            return;
        }

        const { configureButton } = await setup({
            publicAppId: PUBLIC_APP_ID,
        });

        const sdkButton = configureButton({ element: button });

        sdkButton.on("insert-click", async (video) => {
            const { html } = await oembed(video.sharedUrl, { width: 400 });
            insertEmbedPlayer(html);
        });
    }

    init();

</script>