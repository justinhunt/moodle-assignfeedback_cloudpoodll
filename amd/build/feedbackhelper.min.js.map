{"version":3,"file":"feedbackhelper.min.js","sources":["../src/feedbackhelper.js"],"sourcesContent":["import $ from 'jquery';\nimport log from 'core/log';\nimport cloudpoodll from './cloudpoodllloader';\nimport * as str from 'core/str';\n\nlog.debug('cloudpoodll feedback helper: initialising');\n\nconst instancemap = {};\n\nexport default class feedbackHandler {\n\n    togglestate = 0;\n    strings = {};\n    controls = {};\n    registeredtoggler = false;\n\n    constructor(opts) {\n        this.component = opts['component'];\n        this.subtype = opts['subtype'] || '';\n\n        this.register_controls();\n        this.register_events();\n    }\n\n    static init(opts) {\n        return new feedbackHandler(opts);\n    }\n\n\n\n    register_controls() {\n        this.controls.deletebutton = $('.' + this.component + this.subtype + '_deletefeedbackbutton');\n        this.controls.updatecontrol = $('#' + this.component + this.subtype + '_updatecontrol');\n        this.controls.currentcontainer = $('.' + this.component + this.subtype + '_currentfeedback');\n        this.controls.togglecontainer = $('.' + this.component + this.subtype + '_togglecontainer');\n        this.controls.togglebutton = $('.' + this.component + this.subtype + '_togglecontainer .togglebutton');\n        this.controls.toggletext = $('.' + this.component + this.subtype + '_togglecontainer .toggletext');\n        str.get_string('clicktohide', this.component).done(s => {\n            this.strings['clicktohide'] = s;\n        });\n        str.get_string('clicktoshow', this.component).done(s => {\n            this.strings['clicktoshow'] = s;\n        });\n    }\n\n    register_events() {\n        this.controls.deletebutton.click(() => {\n            if (this.controls.updatecontrol) {\n                if (confirm(M.util.get_string('reallydeletefeedback', this.component))) {\n                    this.controls.updatecontrol.val(-1);\n                    this.controls.currentcontainer.html('');\n                }\n            }\n        });\n        this.controls.togglebutton.click(this.toggle_currentfeedback.bind(this));\n        this.controls.toggletext.click(this.toggle_currentfeedback.bind(this));\n    }\n\n    toggle_currentfeedback() {\n        const doToggleState = () => {\n            if (this.togglestate == 0) {\n                this.controls.togglebutton.removeClass('fa-toggle-off');\n                this.controls.togglebutton.addClass('fa-toggle-on');\n                this.controls.toggletext.text(this.strings['clicktohide']);\n                this.togglestate = 1;\n            } else {\n                this.controls.togglebutton.removeClass('fa-toggle-on');\n                this.controls.togglebutton.addClass('fa-toggle-off');\n                this.controls.toggletext.text(this.strings['clicktoshow']);\n                this.togglestate = 0;\n            }\n        };\n        this.controls.currentcontainer.toggle(\n            {duration: 300, complete: doToggleState}\n        );\n        return false;\n    }\n\n    static registerToggler() {\n        if (this.registeredtoggler) {\n            return;\n        }\n        this.registeredtoggler = true;\n        document.addEventListener('click', e => {\n            const toggleinput = e.target.closest('[data-action=\"toggle\"]');\n            if (toggleinput) {\n                try {\n                    const togglecontainer = document.querySelector(toggleinput.dataset.target);\n                    if (togglecontainer) {\n                        const labelElement = toggleinput.closest('label.togglerecorder');\n                        const $togglecontainer = $(togglecontainer);\n                        if (toggleinput.checked) {\n                            $togglecontainer.collapse('show');\n                            labelElement.classList.add('enabledstate');\n                        } else {\n                            $togglecontainer.collapse('hide');\n                            labelElement.classList.remove('enabledstate');\n                        }\n                    }\n                } catch (e) {\n                    //do nothing\n                    log.debug(e);\n                }\n            }\n        });\n\n    }\n}// end of return object."],"names":["debug","feedbackHandler","constructor","opts","component","subtype","register_controls","register_events","controls","deletebutton","this","updatecontrol","currentcontainer","togglecontainer","togglebutton","toggletext","str","get_string","done","s","strings","click","confirm","M","util","val","html","toggle_currentfeedback","bind","toggle","duration","complete","togglestate","removeClass","addClass","text","registeredtoggler","document","addEventListener","e","toggleinput","target","closest","querySelector","dataset","labelElement","$togglecontainer","checked","collapse","classList","add","remove"],"mappings":"gjDAKIA,MAAM,mDAIWC,gBAOjBC,YAAYC,yCALE,kCACJ,oCACC,8CACS,QAGXC,UAAYD,KAAI,eAChBE,QAAUF,KAAI,SAAe,QAE7BG,yBACAC,8BAGGJ,aACD,IAAIF,gBAAgBE,MAK/BG,yBACSE,SAASC,cAAe,mBAAE,IAAMC,KAAKN,UAAYM,KAAKL,QAAU,8BAChEG,SAASG,eAAgB,mBAAE,IAAMD,KAAKN,UAAYM,KAAKL,QAAU,uBACjEG,SAASI,kBAAmB,mBAAE,IAAMF,KAAKN,UAAYM,KAAKL,QAAU,yBACpEG,SAASK,iBAAkB,mBAAE,IAAMH,KAAKN,UAAYM,KAAKL,QAAU,yBACnEG,SAASM,cAAe,mBAAE,IAAMJ,KAAKN,UAAYM,KAAKL,QAAU,uCAChEG,SAASO,YAAa,mBAAE,IAAML,KAAKN,UAAYM,KAAKL,QAAU,gCACnEW,IAAIC,WAAW,cAAeP,KAAKN,WAAWc,MAAKC,SAC1CC,QAAL,YAA8BD,KAElCH,IAAIC,WAAW,cAAeP,KAAKN,WAAWc,MAAKC,SAC1CC,QAAL,YAA8BD,KAItCZ,uBACSC,SAASC,aAAaY,OAAM,KACzBX,KAAKF,SAASG,eACVW,QAAQC,EAAEC,KAAKP,WAAW,uBAAwBP,KAAKN,mBAClDI,SAASG,cAAcc,KAAK,QAC5BjB,SAASI,iBAAiBc,KAAK,aAI3ClB,SAASM,aAAaO,MAAMX,KAAKiB,uBAAuBC,KAAKlB,YAC7DF,SAASO,WAAWM,MAAMX,KAAKiB,uBAAuBC,KAAKlB,OAGpEiB,qCAcSnB,SAASI,iBAAiBiB,OAC3B,CAACC,SAAU,IAAKC,SAdE,KACM,GAApBrB,KAAKsB,kBACAxB,SAASM,aAAamB,YAAY,sBAClCzB,SAASM,aAAaoB,SAAS,qBAC/B1B,SAASO,WAAWoB,KAAKzB,KAAKU,QAAL,kBACzBY,YAAc,SAEdxB,SAASM,aAAamB,YAAY,qBAClCzB,SAASM,aAAaoB,SAAS,sBAC/B1B,SAASO,WAAWoB,KAAKzB,KAAKU,QAAL,kBACzBY,YAAc,OAMpB,2BAIHtB,KAAK0B,yBAGJA,mBAAoB,EACzBC,SAASC,iBAAiB,SAASC,UACzBC,YAAcD,EAAEE,OAAOC,QAAQ,6BACjCF,sBAEU3B,gBAAkBwB,SAASM,cAAcH,YAAYI,QAAQH,WAC/D5B,gBAAiB,OACXgC,aAAeL,YAAYE,QAAQ,wBACnCI,kBAAmB,mBAAEjC,iBACvB2B,YAAYO,SACZD,iBAAiBE,SAAS,QAC1BH,aAAaI,UAAUC,IAAI,kBAE3BJ,iBAAiBE,SAAS,QAC1BH,aAAaI,UAAUE,OAAO,kBAGxC,MAAOZ,gBAEDvC,MAAMuC"}