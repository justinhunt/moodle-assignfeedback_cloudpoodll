{"version":3,"file":"previewcorrections.min.js","sources":["../src/previewcorrections.js"],"sourcesContent":["define(['jquery', 'core/log','core/str','core/ajax','core/notification','assignfeedback_cloudpoodll/correctionsmarkup'],\n    function ($, log, str, Ajax, notification,correctionsmarkup) {\n    \"use strict\"; // jshint ;_;\n    /*\n    This file does small report\n     */\n\n    log.debug('Grammar suggestions: initialising');\n\n    return {\n        //controls\n        controls: {},\n        previewtimer: null,\n\n        //init the module\n        init: function(){\n            log.debug('Preview corrections: feedback cloudpoodll initialising');\n            this.init_strings();\n            this.register_controls();\n            this.register_events();\n        },\n\n        init_strings: function(){\n          var that =this;\n          //str.get_string('checking','assignfeedback_cloudpoodll').done(function(s){that.checking=s;});\n        },\n\n        //load all the controls so we do not have to do it later\n        register_controls: function(){\n            log.debug('Grammar suggestions: registering controls');\n            this.controls.submittedtextarea = $('#id_submittedtext');\n            this.controls.correctionstextarea = $('#id_correctedtext');\n            this.controls.previewcontainer = $('.asf_cp_corrections_cont');\n        },\n\n        //attach the various event handlers we need\n        register_events: function() {\n            var that = this;\n\n\n            that.controls.correctionstextarea.on('input', function() {\n                clearTimeout(that.previewtimer);   // clear the timer whenever the input is changed\n                that.previewtimer = setTimeout(function(\n                ) {  // after 5s, log something to the console\n                    that.render_and_markup();\n                }, 5000);\n            });\n\n        },//end of register events\n\n\n\n        render_and_markup: function () {\n            var that = this;\n            var thepassage = that.controls.submittedtextarea.val();\n            var thecorrections = that.controls.correctionstextarea.val();\n            //if no passage or corrections do nothing\n            if(thepassage.length<1 || thecorrections.length<1){\n                return;\n            }\n\n            Ajax.call([{\n                methodname: 'assignfeedback_cloudpoodll_render_diffs',\n                args: {\n                    passage: thepassage,\n                    corrections: thecorrections,\n                },\n                done: function (ajaxresult) {\n\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        if(payloadobject.markedupsuggestions.length>3){\n                            that.controls.previewcontainer.html(payloadobject.markedupsuggestions);\n                            correctionsmarkup.justmarkup( that.controls.previewcontainer,payloadobject.grammarerrors,payloadobject.grammarmatches);\n                        }\n                    }else{\n                        //something went wrong, user does not really need to know details\n                        log.debug('result not fetched');\n                    }\n\n                },\n                fail: notification.exception\n            }]);\n        },\n\n    };//end of return value\n});"],"names":["define","$","log","str","Ajax","notification","correctionsmarkup","debug","controls","previewtimer","init","init_strings","register_controls","register_events","submittedtextarea","correctionstextarea","previewcontainer","that","this","on","clearTimeout","setTimeout","render_and_markup","thepassage","val","thecorrections","length","call","methodname","args","passage","corrections","done","ajaxresult","payloadobject","JSON","parse","markedupsuggestions","html","justmarkup","grammarerrors","grammarmatches","fail","exception"],"mappings":"AAAAA,uDAAO,CAAC,SAAU,WAAW,WAAW,YAAY,oBAAoB,iDACpE,SAAUC,EAAGC,IAAKC,IAAKC,KAAMC,aAAaC,0BAM1CJ,IAAIK,MAAM,qCAEH,CAEHC,SAAU,GACVC,aAAc,KAGdC,KAAM,WACFR,IAAIK,MAAM,+DACLI,oBACAC,yBACAC,mBAGTF,aAAc,aAMdC,kBAAmB,WACfV,IAAIK,MAAM,kDACLC,SAASM,kBAAoBb,EAAE,0BAC/BO,SAASO,oBAAsBd,EAAE,0BACjCO,SAASQ,iBAAmBf,EAAE,6BAIvCY,gBAAiB,eACTI,KAAOC,KAGXD,KAAKT,SAASO,oBAAoBI,GAAG,SAAS,WAC1CC,aAAaH,KAAKR,cAClBQ,KAAKR,aAAeY,YAAW,WAE3BJ,KAAKK,sBACN,SAOXA,kBAAmB,eACXL,KAAOC,KACPK,WAAaN,KAAKT,SAASM,kBAAkBU,MAC7CC,eAAiBR,KAAKT,SAASO,oBAAoBS,MAEpDD,WAAWG,OAAO,GAAKD,eAAeC,OAAO,GAIhDtB,KAAKuB,KAAK,CAAC,CACPC,WAAY,0CACZC,KAAM,CACFC,QAASP,WACTQ,YAAaN,gBAEjBO,KAAM,SAAUC,gBAERC,cAAgBC,KAAKC,MAAMH,YAC3BC,cACGA,cAAcG,oBAAoBX,OAAO,IACxCT,KAAKT,SAASQ,iBAAiBsB,KAAKJ,cAAcG,qBAClD/B,kBAAkBiC,WAAYtB,KAAKT,SAASQ,iBAAiBkB,cAAcM,cAAcN,cAAcO,iBAI3GvC,IAAIK,MAAM,uBAIlBmC,KAAMrC,aAAasC"}