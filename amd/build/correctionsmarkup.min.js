define(["jquery","core/log"],(function($,log){return log.debug("Corrections Markup: initialising"),{controls:{},cd:{correctionscontainer:"asf_cp_corrections_cont",insertclass:"asf_cp_finediffinsertion",passagewordclass:"asf_cp_grading_passageword",wordclass:"asf_cp_grading_correctionsword",spaceclass:"asf_cp_grading_correctionsspace",suggestionclass:"asf_cp_corrections_suggestedword",wordomittedclass:"asf_cp_corrections_omittedword",aiunmatched:"asf_cp_aiunmatched",aicorrected:"asf_cp_aicorrected"},options:{errorwords:{},grammarmatches:{},suggestedwords:{},insertioncount:0},justmarkup:function(correctionsdiv,sessionerrors,sessionmatches,insertioncount){this.controls.correctionscontainer=$(correctionsdiv),this.options.suggestedwords=JSON.parse(sessionerrors),this.options.grammarmatches=JSON.parse(sessionmatches),this.options.insertioncount=insertioncount,this.markup_suggestedwords(),this.markup_unmatchedwords()},init:function(config){var theid="#"+config.id,configcontrol=$(theid).get(0);if(configcontrol){var opts=JSON.parse(configcontrol.value);$(theid).remove(),""!==opts.sessionerrors?this.options.suggestedwords=JSON.parse(opts.sessionerrors):this.options.suggestedwords={},""!==opts.sessionmatches?this.options.grammarmatches=JSON.parse(opts.sessionmatches):this.options.grammarmatches={},""!==opts.insertioncount?this.options.insertioncount=opts.insertioncount:this.options.insertioncount=0}else{if(!(config.hasOwnProperty("sessionerrors")&&config.hasOwnProperty("sessionmatches")&&config.hasOwnProperty("insertioncount")))return;this.options.suggestedwords=JSON.parse(config.sessionerrors),this.options.grammarmatches=JSON.parse(config.sessionmatches),this.options.insertioncount=config.insertioncount}this.register_controls(),this.markup_suggestedwords(),this.markup_unmatchedwords(),this.register_events()},register_controls:function(){this.controls.correctionscontainer=$("."+this.cd.correctionscontainer)},register_events:function(){var that=this;this.controls.correctionscontainer.on("click","."+this.cd.wordclass+",."+this.cd.spaceclass,(function(){var tpositions=$(this).attr("data-tpositions");void 0!==tpositions&&""!==tpositions&&(that.highlightoriginal(tpositions),setTimeout((function(){that.dehighlightoriginal(tpositions)}),1e3))})),this.controls.correctionscontainer.on("mouseover","."+this.cd.wordclass+",."+this.cd.spaceclass,(function(){var tpositions=$(this).attr("data-tpositions");void 0!==tpositions&&""!==tpositions&&that.highlightoriginal(tpositions)})),this.controls.correctionscontainer.on("mouseout","."+this.cd.wordclass+",."+this.cd.spaceclass,(function(){var tpositions=$(this).attr("data-tpositions");void 0!==tpositions&&""!==tpositions&&that.dehighlightoriginal(tpositions)}))},highlightoriginal:function(tpositionstring){var that=this,tpositions=tpositionstring.split(",");$.each(tpositions,(function(index,tposition){$("#"+that.cd.passagewordclass+"_"+tposition).addClass(that.cd.aicorrected)}))},dehighlightoriginal:function(tpositionstring){var that=this,tpositions=tpositionstring.split(",");$.each(tpositions,(function(index,tposition){$("#"+that.cd.passagewordclass+"_"+tposition).removeClass(that.cd.aicorrected)}))},markup_suggestedwords:function(){var m=this;if($.each(m.options.suggestedwords,(function(index){$("."+m.cd.correctionscontainer+" #"+m.cd.wordclass+"_"+m.options.suggestedwords[index].wordnumber).addClass(m.cd.suggestionclass)})),Object.keys(m.options.grammarmatches).length>0){var lastpposition=0,lasttposition=0;$.each(m.options.grammarmatches,(function(index,lastmatch){lastpposition=Number(lastmatch.pposition),lasttposition=Number(lastmatch.tposition)}));for(var lastwordnumber=Number(lastpposition),tpositions=[],i=lasttposition+1;i<=lasttposition+m.options.insertioncount+1;i++)tpositions.push(i);$("."+m.cd.correctionscontainer+" ."+m.cd.wordclass).filter((function(){return Number($(this).data("wordnumber"))>lastwordnumber&&!$(this).hasClass(m.cd.suggestionclass)})).addClass(m.cd.suggestionclass).attr("data-tpositions",tpositions.join(","))}},markup_unmatchedwords:function(){var that=this;if(this.options.grammarmatches){var prevmatch={tposition:0,pposition:0};$.each(this.options.grammarmatches,(function(index,match){if(match.tposition-prevmatch.tposition>1){var missingwordspacenumber=match.pposition-1;if(missingwordspacenumber>0){$("#"+that.cd.wordclass+"_"+match.pposition).hasClass(that.cd.suggestionclass)||$("#"+that.cd.wordclass+"_"+missingwordspacenumber).hasClass(that.cd.suggestionclass)||$("#"+that.cd.spaceclass+"_"+missingwordspacenumber).addClass(that.cd.wordomittedclass);for(var tpositions=[],i=prevmatch.tposition+1;i<match.tposition;i++)tpositions.push(i);if(0===match.pposition-prevmatch.pposition-1)$("#"+that.cd.spaceclass+"_"+missingwordspacenumber).attr("data-tpositions",tpositions.join(","));else for(var z=prevmatch.pposition+1;z<match.pposition;z++)$("#"+that.cd.spaceclass+"_"+z).attr("data-tpositions",tpositions.join(",")),$("#"+that.cd.wordclass+"_"+z).attr("data-tpositions",tpositions.join(","))}}$("#"+that.cd.wordclass+"_"+match.pposition).attr("data-tpositions",match.tposition),prevmatch=match}))}}}}));

//# sourceMappingURL=correctionsmarkup.min.js.map