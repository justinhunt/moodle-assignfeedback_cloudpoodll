{"version":3,"file":"interactivetranscript.min.js","sources":["../src/interactivetranscript.js"],"sourcesContent":["define(['jquery', 'core/log'], function ($, log) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Interactive Transcript: initialising');\n\n    return {\n\n        init: function (opts) {\n\n            var component = opts['component'];\n            var playerid = opts['playerid'];\n            var containerid = opts['containerid'];\n            var cssprefix = opts['cssprefix'];\n            var config = {};\n            config.settings = {};\n            if (playerid && $('#' + playerid).length) {\n                config.component = component;\n                config.prefix = cssprefix;\n                config.player = $('#' + playerid)[0];\n                config.title = M.util.get_string('transcripttitle', component);\n                this.doPolyfills();\n                var transcript = this.transcript(config);\n                $('#' + containerid).append(transcript.el());\n            }\n        },\n\n        doPolyfills: function () {\n            // requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel\n            // MIT license\n            // https://gist.github.com/paulirish/1579671\n            var lastTime = 0;\n            var vendors = ['ms', 'moz', 'webkit', 'o'];\n            for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n                window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n                window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\n                    || window[vendors[x] + 'CancelRequestAnimationFrame'];\n            }\n            if (!window.requestAnimationFrame) {\n                window.requestAnimationFrame = function (callback, element) {\n                    var currTime = new Date().getTime();\n                    var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n                    var id = window.setTimeout(function () {\n                            callback(currTime + timeToCall);\n                    },\n                        timeToCall);\n                    lastTime = currTime + timeToCall;\n                    return id;\n                };\n            }\n            if (!window.cancelAnimationFrame) {\n                window.cancelAnimationFrame = function (id) {\n                    clearTimeout(id);\n                };\n            }\n\n            // Object.create() polyfill\n            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create#Polyfill\n            if (typeof Object.create != 'function') {\n                Object.create = (function () {\n                    var Object = function () {\n                    };\n                    return function (prototype) {\n                        if (arguments.length > 1) {\n                            throw Error('Second argument not supported');\n                        }\n                        if (typeof prototype != 'object') {\n                            throw TypeError('Argument must be an object');\n                        }\n                        Object.prototype = prototype;\n                        var result = {};\n                        Object.prototype = null;\n                        return result;\n                    };\n                })();\n            }\n\n            // forEach polyfill\n            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#Polyfill\n            if (!Array.prototype.forEach) {\n                Array.prototype.forEach = function (callback, thisArg) {\n                    var T, k;\n                    if (this == null) {\n                        throw new TypeError(' this is null or not defined');\n                    }\n                    var O = Object(this);\n                    var len = O.length >>> 0;\n                    if (typeof callback != \"function\") {\n                        throw new TypeError(callback + ' is not a function');\n                    }\n                    if (arguments.length > 1) {\n                        T = thisArg;\n                    }\n                    k = 0;\n                    while (k < len) {\n                        var kValue;\n                        if (k in O) {\n                            kValue = O[k];\n                            callback.call(T, kValue, k, O);\n                        }\n                        k++;\n                    }\n                };\n            }\n\n            // classList polyfill\n            /*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/\n            if (\"document\" in self && !(\"classList\" in document.createElement(\"_\"))) {\n                (function (j) {\n                    \"use strict\";\n                    if (!(\"Element\" in j)) {\n                        return\n                    }\n                    var a = \"classList\", f = \"prototype\", m = j.Element[f], b = Object, k = String[f].trim || function () {\n                        return this.replace(/^\\s+|\\s+$/g, \"\")\n                    }, c = Array[f].indexOf || function (q) {\n                        var p = 0, o = this.length;\n                        for (; p < o; p++) {\n                            if (p in this && this[p] === q) {\n                                return p\n                            }\n                        }\n                        return -1\n                    }, n = function (o, p) {\n                        this.name = o;\n                        this.code = DOMException[o];\n                        this.message = p\n                    }, g = function (p, o) {\n                        if (o === \"\") {\n                            throw new n(\"SYNTAX_ERR\", \"An invalid or illegal string was specified\")\n                        }\n                        if (/\\s/.test(o)) {\n                            throw new n(\"INVALID_CHARACTER_ERR\", \"String contains an invalid character\")\n                        }\n                        return c.call(p, o)\n                    }, d = function (s) {\n                        var r = k.call(s.getAttribute(\"class\") || \"\"), q = r ? r.split(/\\s+/) : [], p = 0, o = q.length;\n                        for (; p < o; p++) {\n                            this.push(q[p])\n                        }\n                        this._updateClassName = function () {\n                            s.setAttribute(\"class\", this.toString())\n                        }\n                    }, e = d[f] = [], i = function () {\n                        return new d(this)\n                    };\n                    n[f] = Error[f];\n                    e.item = function (o) {\n                        return this[o] || null\n                    };\n                    e.contains = function (o) {\n                        o += \"\";\n                        return g(this, o) !== -1\n                    };\n                    e.add = function () {\n                        var s = arguments, r = 0, p = s.length, q, o = false;\n                        do {\n                            q = s[r] + \"\";\n                            if (g(this, q) === -1) {\n                                this.push(q);\n                                o = true\n                            }\n                        } while (++r < p);\n                        if (o) {\n                            this._updateClassName()\n                        }\n                    };\n                    e.remove = function () {\n                        var t = arguments, s = 0, p = t.length, r, o = false;\n                        do {\n                            r = t[s] + \"\";\n                            var q = g(this, r);\n                            if (q !== -1) {\n                                this.splice(q, 1);\n                                o = true\n                            }\n                        } while (++s < p);\n                        if (o) {\n                            this._updateClassName()\n                        }\n                    };\n                    e.toggle = function (p, q) {\n                        p += \"\";\n                        var o = this.contains(p), r = o ? q !== true && \"remove\" : q !== false && \"add\";\n                        if (r) {\n                            this[r](p)\n                        }\n                        return !o\n                    };\n                    e.toString = function () {\n                        return this.join(\" \")\n                    };\n                    if (b.defineProperty) {\n                        var l = {get: i, enumerable: true, configurable: true};\n                        try {\n                            b.defineProperty(m, a, l)\n                        } catch (h) {\n                            if (h.number === -2146823252) {\n                                l.enumerable = false;\n                                b.defineProperty(m, a, l)\n                            }\n                        }\n                    } else {\n                        if (b[f].__defineGetter__) {\n                            m.__defineGetter__(a, i)\n                        }\n                    }\n                }(self))\n            }\n        },//end of polyfills\n\n        // Defaults\n        defaults: {\n            autoscroll: true,\n            clickArea: 'line', // the clickable part of line text,line,timestamp, none\n            showTitle: true, // the title\n            showTrackSelector: false, // the drop down box of caption tracks\n            followPlayerTrack: true,\n            scrollToCenter: false, // show current text in center\n            stopScrollWhenInUse: true, // stop scrolling when user interacting\n        },\n\n        /*global */\n        utils: {\n            prefix: 'transcript',\n            secondsToTime: function (timeInSeconds) {\n                var hour = Math.floor(timeInSeconds / 3600);\n                var min = Math.floor(timeInSeconds % 3600 / 60);\n                var sec = Math.floor(timeInSeconds % 60);\n                sec = (sec < 10) ? '0' + sec : sec;\n                min = (hour > 0 && min < 10) ? '0' + min : min;\n                if (hour > 0) {\n                    return hour + ':' + min + ':' + sec;\n                }\n                return min + ':' + sec;\n            },\n            localize: function (string) {\n                return string; // TODO: do something here;\n            },\n            createEl: function (elementName, className) {\n                className = className || '';\n                var el = document.createElement(elementName);\n                el.className = className;\n                return el;\n            },\n            extend: function (obj) {\n                var type = typeof obj;\n                if (!(type === 'function' || type === 'object' && !!obj)) {\n                    return obj;\n                }\n                var source, prop;\n                for (var i = 1, length = arguments.length; i < length; i++) {\n                    source = arguments[i];\n                    for (prop in source) {\n                        obj[prop] = source[prop];\n                    }\n                }\n                return obj;\n            }\n        },\n\n        eventEmitter: {\n            handlers_: [],\n            on: function on(object, eventtype, callback) {\n                if (typeof callback === 'function') {\n                    this.handlers_.push([object, eventtype, callback]);\n                } else {\n                    throw new TypeError('Callback is not a function.');\n                }\n            },\n            trigger: function trigger(object, eventtype) {\n                this.handlers_.forEach(function (h) {\n                    if (h[0] === object &&\n                        h[1] === eventtype) {\n                        h[2].apply();\n                    }\n                });\n            }\n        },\n\n        scrollerProto: function (config) {\n\n            var initHandlers = function (el) {\n                var self = this;\n                // The scroll event. We want to keep track of when the user is scrolling the transcript.\n                el.addEventListener('scroll', function () {\n                    if (self.isAutoScrolling) {\n\n                        // If isAutoScrolling was set to true, we can set it to false and then ignore this event.\n                        // It wasn't the user.\n                        self.isAutoScrolling = false; // event handled\n                    } else {\n\n                        // We only care about when the user scrolls. Set userIsScrolling to true and add a nice class.\n                        self.userIsScrolling = true;\n                        el.classList.add('is-inuse');\n                    }\n                });\n\n                // The mouseover event.\n                el.addEventListener('mouseenter', function () {\n                    self.mouseIsOverTranscript = true;\n                });\n                el.addEventListener('mouseleave', function () {\n                    self.mouseIsOverTranscript = false;\n\n                    // Have a small delay before deciding user as done interacting.\n                    setTimeout(function () {\n\n                        // Make sure the user didn't move the pointer back in.\n                        if (!self.mouseIsOverTranscript) {\n                            self.userIsScrolling = false;\n                            el.classList.remove('is-inuse');\n                        }\n                    }, 1000);\n                });\n            };\n\n            // Init instance variables\n            var init = function (element) {\n                this.element = element;\n                this.userIsScrolling = false;\n\n                // default to true in case user isn't using a mouse;\n                this.mouseIsOverTranscript = true;\n                this.isAutoScrolling = true;\n                initHandlers.call(this, this.element);\n                return this;\n            };\n\n            // Easing function for smoothness.\n            var easeOut = function (time, start, change, duration) {\n                return start + change * Math.sin(Math.min(1, time / duration) * (Math.PI / 2));\n            };\n\n            // Animate the scrolling.\n            var scrollTo = function (element, newPos, duration) {\n                var startTime = Date.now();\n                var startPos = element.scrollTop;\n                var self = this;\n\n                // Don't try to scroll beyond the limits. You won't get there and this will loop forever.\n                newPos = Math.max(0, newPos);\n                newPos = Math.min(element.scrollHeight - element.clientHeight, newPos);\n                var change = newPos - startPos;\n\n                // This inner function is called until the elements scrollTop reaches newPos.\n                var updateScroll = function () {\n                    var now = Date.now();\n                    var time = now - startTime;\n                    self.isAutoScrolling = true;\n                    element.scrollTop = easeOut(time, startPos, change, duration);\n                    if (element.scrollTop !== newPos) {\n                        requestAnimationFrame(updateScroll, element);\n                    }\n                };\n                requestAnimationFrame(updateScroll, element);\n            };\n\n            // Scroll an element's parent so the element is brought into view.\n            var scrollToElement = function (element) {\n                if (this.canScroll()) {\n                    var parent = element.parentElement;\n                    var parentOffsetBottom = parent.offsetTop + parent.clientHeight;\n                    var elementOffsetBottom = element.offsetTop + element.clientHeight;\n                    var relTop = element.offsetTop;\n                    var relBottom = (element.offsetTop + element.clientHeight);\n                    var centerPosCorrection = 0;\n                    var newPos;\n                    /*\n                                        console.log('element.offsetTop: ' + element.offsetTop );\n                                        console.log('element.clientHeight: ' + element.clientHeight );\n                                        console.log('parent.offsetTop: ' + parent.offsetTop );\n                                        console.log('parent.scrollTop: ' + parent.scrollTop );\n                                        console.log('parent.clientHeight: ' + parent.clientHeight );\n                                        console.log(element);\n                                        console.log(parent);\n                    */\n                    // scroll to center if we must\n                    if (config.settings.scrollToCenter) {\n                        centerPosCorrection = Math.round(parent.clientHeight / 2 - element.clientHeight / 2);\n                    }\n                    // If the top of the line is above the top of the parent view, were scrolling up,\n                    // so we want to move the top of the element downwards to match the top of the parent.\n                    if (relTop < parent.scrollTop + centerPosCorrection) {\n                        newPos = element.offsetTop - centerPosCorrection;\n\n                        // If the bottom of the line is below the parent view, we're scrolling down, so we want the\n                        // bottom edge of the line to move up to meet the bottom edge of the parent.\n                    } else if (relBottom > (parent.scrollTop + parent.clientHeight) - centerPosCorrection) {\n                        newPos = elementOffsetBottom + centerPosCorrection;\n                    }\n\n                    // Don't try to scroll if we haven't set a new position.  If we didn't\n                    // set a new position the line is already in view (i.e. It's not above\n                    // or below the view)\n                    // And don't try to scroll when the element is already in position.\n                    if (newPos !== undefined && parent.scrollTop !== newPos) {\n                        scrollTo.call(this, parent, newPos, 400);\n                    }\n                }\n            };\n\n            // Return whether the element is scrollable.\n            var canScroll = function () {\n                var el = this.element;\n                // console.log(el.scrollHeight + ' ' + el.offsetHeight);\n                return el.scrollHeight > el.offsetHeight;\n            };\n\n            // Return whether the user is interacting with the transcript.\n            var inUse = function () {\n                return this.userIsScrolling;\n            };\n\n            return {\n                init: init,\n                to: scrollToElement,\n                canScroll: canScroll,\n                inUse: inUse\n            }\n        },\n\n        scroller: function (element, config) {\n            return Object.create(this.scrollerProto(config)).init(element);\n        },\n\n        /*global config*/\n        trackList: function (config) {\n            var activeTrack;\n            return {\n                get: function () {\n                    var validTracks = [];\n                    var i, track;\n                    config.tracks = config.player.textTracks;\n                    for (i = 0; i < config.tracks.length; i++) {\n                        track = config.tracks[i];\n                        if (track.kind === 'captions' || track.kind === 'subtitles') {\n                            validTracks.push(track);\n                        }\n                    }\n                    return validTracks;\n                },\n                active: function (tracks) {\n                    var i, track;\n                    for (i = 0; i < config.tracks.length; i++) {\n                        track = config.tracks[i];\n                        if (track.mode === 'showing') {\n                            activeTrack = track;\n                            return track;\n                        }\n                    }\n                    // fallback to first track\n                    return activeTrack || tracks[0];\n                },\n            };\n        },\n\n        /*globals utils, eventEmitter,scrollable*/\n\n        widget: function (config) {\n            var that = this;\n            var thewidget = {};\n            thewidget.element = {};\n            thewidget.body = {};\n            var on = function (event, callback) {\n                eventEmitter.on(that, event, callback);\n            };\n            var trigger = function (event) {\n                eventEmitter.trigger(that, event);\n            };\n            var createTitle = function () {\n                var header = that.utils.createEl('header', config.prefix + '-header');\n                header.textContent = config.title;\n                return header;\n            };\n            var createSelector = function () {\n                var selector = that.utils.createEl('select', config.prefix + '-selector');\n                config.validTracks.forEach(function (track, i) {\n                    var option = document.createElement('option');\n                    option.value = i;\n                    option.textContent = track.label + ' (' + track.language + ')';\n                    selector.appendChild(option);\n                });\n                selector.addEventListener('change', function (e) {\n                    setTrack(document.querySelector('#' + config.prefix + '-' + config.player.id + ' option:checked').value);\n                    trigger('trackchanged');\n                });\n                return selector;\n            };\n            var clickToSeekHandler = function (event) {\n                var clickedClasses = event.target.classList;\n                var clickedTime = event.target.getAttribute('data-begin') || event.target.parentElement.getAttribute('data-begin');\n                if (clickedTime !== undefined && clickedTime !== null) { // can be zero\n                    if ((config.settings.clickArea === 'line') || // clickArea: 'line' activates on all elements\n                        (config.settings.clickArea === 'timestamp' && clickedClasses.contains(config.prefix + '-timestamp')) ||\n                        (config.settings.clickArea === 'text' && clickedClasses.contains(config.prefix + '-text'))) {\n                        config.player.currentTime = clickedTime;\n                    }\n                }\n            };\n            var createLine = function (cue) {\n                var line = that.utils.createEl('div', config.prefix + '-line');\n                var timestamp = that.utils.createEl('span', config.prefix + '-timestamp');\n                var text = that.utils.createEl('span', config.prefix + '-text');\n                line.setAttribute('data-begin', cue.startTime);\n                line.setAttribute('tabindex', thewidget._options.tabIndex || 0);\n                timestamp.textContent = that.utils.secondsToTime(cue.startTime);\n                text.innerHTML = cue.text;\n                line.appendChild(timestamp);\n                line.appendChild(text);\n                return line;\n            };\n            var createTranscriptBody = function (track) {\n                if (typeof track !== 'object') {\n                    track = config.player.textTracks()[track];\n                }\n                var body = that.utils.createEl('div', config.prefix + '-body');\n                var line, i;\n                var fragment = document.createDocumentFragment();\n                // activeCues returns null when the track isn't loaded (for now?)\n                if (!track.activeCues) {\n                    // If cues aren't loaded, set mode to hidden, wait, and try again.\n                    // But don't hide an active track. In that case, just wait and try again.\n                    if (track.mode !== 'showing') {\n                        track.mode = 'hidden';\n                    }\n                    window.setTimeout(function () {\n                        createTranscriptBody(track);\n                    }, 100);\n                } else {\n                    var cues = track.cues;\n                    for (i = 0; i < cues.length; i++) {\n                        line = createLine(cues[i]);\n                        fragment.appendChild(line);\n                    }\n                    body.innerHTML = '';\n                    body.appendChild(fragment);\n                    body.setAttribute('lang', track.language);\n                    body.scroll = that.scroller(body, config);\n                    body.addEventListener('click', clickToSeekHandler);\n                    thewidget.element.replaceChild(body, thewidget.body);\n                    thewidget.body = body;\n                }\n\n            };\n            var create = function (options) {\n                var el = document.createElement('div');\n                thewidget._options = options;\n                thewidget.element = el;\n                el.setAttribute('id', config.prefix + '-' + config.player.id);\n                if (config.settings.showTitle) {\n                    var title = createTitle();\n                    el.appendChild(title);\n                }\n                if (config.settings.showTrackSelector) {\n                    var selector = createSelector();\n                    el.appendChild(selector);\n                }\n                thewidget.body = that.utils.createEl('div', config.prefix + '-body');\n                el.appendChild(thewidget.body);\n                setTrack(config.currentTrack);\n                return this;\n            };\n            var setTrack = function (track, trackCreated) {\n                createTranscriptBody(track, trackCreated);\n            };\n            var setCue = function (time) {\n                var active, i, line, begin, end;\n                var lines = thewidget.body.children;\n                for (i = 0; i < lines.length; i++) {\n                    line = lines[i];\n                    begin = line.getAttribute('data-begin');\n                    if (i < lines.length - 1) {\n                        end = lines[i + 1].getAttribute('data-begin');\n                    } else {\n                        end = config.player.duration || Infinity;\n                    }\n                    if (time > begin && time < end) {\n                        if (!line.classList.contains('is-active')) { // don't update if it hasn't changed\n                            line.classList.add('is-active');\n                            if (config.settings.autoscroll && !(config.settings.stopScrollWhenInUse && thewidget.body.scroll.inUse())) {\n                                thewidget.body.scroll.to(line);\n                            }\n                        }\n                    } else {\n                        line.classList.remove('is-active');\n                    }\n                }\n            };\n            var el = function () {\n                return thewidget.element;\n            };\n            return {\n                create: create,\n                setTrack: setTrack,\n                setCue: setCue,\n                el: el,\n                on: on,\n                trigger: trigger,\n            };\n        },\n\n        transcript: function (config) {\n            var that = this;\n            var options = this.defaults;\n            this.utils.prefix = 'transcript';\n\n            config.validTracks = this.trackList(config).get();\n            config.currentTrack = this.trackList(config).active(config.validTracks);\n            config.settings = options;\n            config.widget = this.widget(config).create(options);\n\n            var timeUpdate = function () {\n                config.widget.setCue(config.player.currentTime);\n            };\n            var updateTrack = function () {\n                config.currentTrack = that.trackList(config).active(config.validTracks);\n                config.widget.setTrack(config.currentTrack);\n            };\n            if (config.validTracks.length > 0) {\n                updateTrack();\n                config.player.ontimeupdate = timeUpdate;\n                if (config.settings.followPlayerTrack) {\n                    config.player.oncaptionstrackchange = updateTrack;\n                    config.player.onsubtitlestrackchange = updateTrack;\n                }\n            } else {\n                throw new Error('transcript: No tracks found!');\n            }\n            return {\n                el: function () {\n                    return config.widget.el();\n                },\n                setTrack: config.widget.setTrack\n            };\n        }\n\n    };// end of return object\n});"],"names":["define","$","log","debug","init","opts","component","playerid","containerid","cssprefix","config","length","prefix","player","title","M","util","get_string","doPolyfills","transcript","this","append","el","lastTime","vendors","x","window","requestAnimationFrame","cancelAnimationFrame","callback","element","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","Object","create","prototype","arguments","Error","TypeError","result","Array","forEach","thisArg","T","k","O","len","kValue","call","self","document","createElement","j","a","f","m","Element","b","String","trim","replace","c","indexOf","q","p","o","n","name","code","DOMException","message","g","test","d","s","r","getAttribute","split","push","_updateClassName","setAttribute","toString","e","i","item","contains","add","remove","t","splice","toggle","join","defineProperty","l","get","enumerable","configurable","h","number","__defineGetter__","defaults","autoscroll","clickArea","showTitle","showTrackSelector","followPlayerTrack","scrollToCenter","stopScrollWhenInUse","utils","secondsToTime","timeInSeconds","hour","floor","min","sec","localize","string","createEl","elementName","className","extend","obj","source","prop","type","eventEmitter","handlers_","on","object","eventtype","trigger","apply","scrollerProto","initHandlers","addEventListener","isAutoScrolling","userIsScrolling","classList","mouseIsOverTranscript","scrollTo","newPos","duration","startTime","now","startPos","scrollTop","change","scrollHeight","clientHeight","updateScroll","time","start","sin","PI","easeOut","to","canScroll","parent","parentElement","elementOffsetBottom","offsetTop","relTop","relBottom","centerPosCorrection","settings","round","undefined","offsetHeight","inUse","scroller","trackList","activeTrack","track","validTracks","tracks","textTracks","kind","active","mode","widget","that","thewidget","event","clickToSeekHandler","clickedClasses","target","clickedTime","currentTime","createLine","cue","line","timestamp","text","_options","tabIndex","textContent","innerHTML","appendChild","createTranscriptBody","body","fragment","createDocumentFragment","activeCues","cues","language","scroll","replaceChild","setTrack","trackCreated","options","header","selector","option","value","label","querySelector","createSelector","currentTrack","setCue","begin","end","lines","children","Infinity","updateTrack","ontimeupdate","oncaptionstrackchange","onsubtitlestrackchange"],"mappings":"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"}