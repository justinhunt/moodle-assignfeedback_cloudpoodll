define(["jquery","core/log","core/str","core/ajax","core/notification","core/modal_factory","core/modal_events","assignfeedback_cloudpoodll/correctionsmarkup"],(function($,log,str,Ajax,notification,ModalFactory,ModalEvents,correctionsmarkup){return log.debug("Grammar suggestions: initialising"),{controls:{},checking:"... checking ...",nosuggestions:"No suggestions",overwrite:"OVERWRITE",overwritesuggestions:"Overwrite the existing grammar suggestions?",overwritewarning:"WARNING: Overwrite",init:function(){this.init_strings(),this.register_controls(),this.register_events()},init_strings:function(){var that=this;str.get_string("checking","assignfeedback_cloudpoodll").done((function(s){that.checking=s})),str.get_string("nosuggestions","assignfeedback_cloudpoodll").done((function(s){that.nosuggestions=s})),str.get_string("overwrite","assignfeedback_cloudpoodll").done((function(s){that.overwrite=s})),str.get_string("overwritesuggestions","assignfeedback_cloudpoodll").done((function(s){that.overwritesuggestions=s})),str.get_string("overwritewarning","assignfeedback_cloudpoodll").done((function(s){that.overwritewarning=s}))},register_controls:function(){this.controls.checkgrammarbutton=$(".grammarsuggestionstrigger")},register_events:function(){var that=this;that.controls.checkgrammarbutton.click((function(e){var srcselector=$(this).data("src"),targetselector=$(this).data("target"),differenceselector=$(this).data("difference"),language=$(this).data("language");return that.get_value($(targetselector)).length>0?ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:that.overwritewarning,body:that.overwritesuggestions}).then((function(themodal){return themodal.setSaveButtonText(that.overwrite),themodal.getRoot().on(ModalEvents.save,(function(e){that.check_grammar(that,srcselector,targetselector,differenceselector,language)})),themodal.show(),themodal})):that.check_grammar(that,srcselector,targetselector,differenceselector,language),!1}))},set_value:function(element,value,type){if(element.is("textarea"))$(element).val(value);else if("html"===type)$(element).html(value);else $(element).text(value)},get_value:function(element){return element.is("textarea")?$(element).val():$(element).text()},check_grammar:function(that,srcselector,targetselector,differenceselector,language){var src_element=$(srcselector),target_element=$(targetselector),difference_element=$(differenceselector),text=that.get_value(src_element);text&&""!==text&&""!==text.trim()&&(that.set_value(target_element,that.checking,"text"),Ajax.call([{methodname:"assignfeedback_cloudpoodll_check_grammar",args:{text:text,language:language},done:function(ajaxresult){var payloadobject=JSON.parse(ajaxresult);if(payloadobject)if(payloadobject.grammarerrors.length<3)that.set_value(target_element,that.nosuggestions,"text");else{that.set_value(target_element,payloadobject.suggestions,"text"),that.set_value(difference_element,payloadobject.markedupsuggestions,"html");var opts=[];opts.sessionerrors=payloadobject.grammarerrors,opts.sessionmatches=payloadobject.grammarmatches,correctionsmarkup.justmarkup(differenceselector,payloadobject.grammarerrors,payloadobject.grammarmatches,payloadobject.insertioncount),$(".asf_cp_correctionspreview_cont").show()}else notification.alert(that.nosuggestions),log.debug("result not fetched")},fail:notification.exception}]))}}}));

//# sourceMappingURL=grammarsuggestions.min.js.map